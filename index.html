<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>VeeNa_Core SmartFridge v0.1</title>
  <style>

  body {
    background: url('images/fridge.png') no-repeat center center fixed;
  background-size: cover;

    margin: 0;
    padding: 2rem;
    font-family: 'Orbitron', sans-serif;
    color: #ffffff;
    
  }

  h1 {
    text-align: center;
    font-size: 1.8rem;
    margin-bottom: 2rem;
    color: #00ffe7;
  }

  input, button {
    margin: 0.5rem;
    padding: 0.5rem;
    border: none;
    border-radius: 5px;
    font-size: 1rem;
  }

  input {
    background-color: #222;
    color: #fff;
    border: 1px solid #555;
  }

  button {
    background-color: #00ffe7;
    color: #000;
    cursor: pointer;
    transition: background 0.3s ease;
  }

  button:hover {
    background-color: #00bfa6;
  }

  ul {
    list-style: none;
    padding: 0;
    margin-top: 2rem;
  }

  li {
    background-color: #1e1e1e;
    margin: 0.5rem 0;
    padding: 0.7rem;
    border-radius: 5px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  li span {
    flex-grow: 1;
  }

  li button {
    background-color: #ff4b5c;
    color: #fff;
    margin-left: 1rem;
  }

  li button:hover {
    background-color: #cc3b4a;
  }
</style>

</head>
<script src="https://unpkg.com/html5-qrcode@2.3.7/minified/html5-qrcode.min.js"></script>
<body>
  <h1>ðŸ§Š VeeNa_Core SmartFridge v0.1</h1>

<input type="text" id="productName" placeholder="Nom du produit">
<input type="number" id="productQty" placeholder="QuantitÃ©" min="1">
<input type="date" id="productDate" placeholder="Date de pÃ©remption">
<button id="addBtn">âž• Ajouter</button>
<button onclick="startScanner()">ðŸ“· Scanner code-barres</button>
<div id="reader" style="width: 300px; margin-top: 1rem;"></div>

<ul id="productList"></ul>

  <script type="module">
    // âš ï¸ Ã€ TOI DE CONFIGURER Firestore ici :
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

   const firebaseConfig = {

  apiKey: "AIzaSyCX1T2-lVJsT3PgyXoEiEteXytl-d84C74",

  authDomain: "veenacore-smartfridge.firebaseapp.com",

  projectId: "veenacore-smartfridge",

  storageBucket: "veenacore-smartfridge.firebasestorage.app",

  messagingSenderId: "754721529662",

  appId: "1:754721529662:web:b8886c63353e8ecbd5966f"

};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const fridgeRef = collection(db, "smartfridge");

async function addProduct() {
  const name = document.getElementById("productName").value.trim();
  const qty = parseInt(document.getElementById("productQty").value.trim(), 10);
  const expirationDate = document.getElementById("productDate").value;

  if (!name || isNaN(qty) || !expirationDate) {
    return alert("Remplis tous les champs !");
  }

  await addDoc(fridgeRef, {
    name,
    qty,
    expirationDate
  });
} // ðŸ‘ˆ FIN de la fonction addProduct() ici âœ…

async function deleteProduct(id) {
  await deleteDoc(doc(db, "smartfridge", id));
}

onSnapshot(fridgeRef, (snapshot) => {
  const list = document.getElementById("productList");
  list.innerHTML = "";

  snapshot.forEach((docSnap) => {
    const data = docSnap.data();
    const li = document.createElement("li");
    li.textContent = `${data.name} (${data.qty}) - pÃ©rime le ${data.expirationDate}`;

    const btn = document.createElement("button");
    btn.textContent = "ðŸ—‘ï¸ Retirer";
    btn.onclick = () => deleteProduct(docSnap.id);

    li.appendChild(btn);
    list.appendChild(li);
  });
});

document.getElementById("addBtn").addEventListener("click", addProduct);

  function startScanner() {
  const html5QrCode = new Html5Qrcode("reader");

  html5QrCode.start(
    { facingMode: "environment" },
    {
      fps: 10,
      qrbox: 250
    },
    (decodedText, decodedResult) => {
      console.log(`Scanned: ${decodedText}`);
      document.getElementById("productName").value = decodedText;
      html5QrCode.stop(); // stop after successful scan
    },
    (errorMessage) => {
      // Ignorer les erreurs mineures
    }
  ).catch((err) => {
    console.error("Erreur du scanner :", err);
  });
}

  </script>
</body>
</html>
